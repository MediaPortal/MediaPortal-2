<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">
  
  <PropertyGroup>
    <DefineConstants>
      SlimTv.Client.TargetDir=$(SolutionDir)..\Bin\MP2-Client\bin\$(Configuration)\Plugins\SlimTv.Client;
      SlimTv.NativeProvider.TargetDir=$(SolutionDir)..\Bin\MP2-Client\bin\$(Configuration)\Plugins\SlimTv.NativeProvider;
      SlimTv.Service3.TargetDir=$(SolutionDir)..\Bin\MP2-Server\bin\$(Configuration)\Plugins\SlimTv.Service3;
      SlimTv.Service35.TargetDir=$(SolutionDir)..\Bin\MP2-Server\bin\$(Configuration)\Plugins\SlimTv.Service35
    </DefineConstants>
  </PropertyGroup>

  <UsingTask TaskName="HeatDirectory"
    AssemblyFile="$(WixToolPath)WixUtilExtension.dll" />

  <Target Name="BeforeBuild">

    <HeatDirectory
      Directory="$(SolutionDir)..\Bin\MP2-Client\bin\$(Configuration)"
      PreprocessorVariable="var.MediaPortal.Client.TargetDir"
      ComponentGroupName="Client.Heat"
      DirectoryRefId="INSTALLDIR_CLIENT"
      Transforms="$(ProjectDir)xslt\Client.Heat.xslt"
      OutputFile="$(ProjectDir)Features\Client.Heat.wxs"
      GenerateGuidsNow="true" SuppressCom="true" SuppressRegistry="true" SuppressFragments="true" SuppressRootDirectory="true" ToolPath="$(WixToolPath)" />

    <HeatDirectory
      Directory="$(SolutionDir)..\Bin\MP2-Server\bin\$(Configuration)"
      PreprocessorVariable="var.MediaPortal.Server.TargetDir"
      ComponentGroupName="Server.Heat"
      DirectoryRefId="INSTALLDIR_SERVER"
      Transforms="$(ProjectDir)xslt\Server.Heat.xslt"
      OutputFile="$(ProjectDir)Features\Server.Heat.wxs"
      GenerateGuidsNow="true" SuppressCom="true" SuppressRegistry="true" SuppressFragments="true" SuppressRootDirectory="true" ToolPath="$(WixToolPath)" />

    <HeatDirectory
      Directory="$(SolutionDir)..\Bin\MP2-ServiceMonitor\bin\$(Configuration)"
      PreprocessorVariable="var.MediaPortal.ServiceMonitor.TargetDir"
      ComponentGroupName="ServiceMonitor.Heat"
      DirectoryRefId="INSTALLDIR_SERVICE_MONITOR"
      Transforms="$(ProjectDir)xslt\ServiceMonitor.Heat.xslt"
      OutputFile="$(ProjectDir)Features\ServiceMonitor.Heat.wxs"
      GenerateGuidsNow="true" SuppressCom="true" SuppressRegistry="true" SuppressFragments="true" SuppressRootDirectory="true" ToolPath="$(WixToolPath)" />

    <HeatDirectory
      Directory="$(SolutionDir)..\Bin\MP2-LogCollector\bin\$(Configuration)"
      PreprocessorVariable="var.MediaPortal.LogCollector.TargetDir"
      ComponentGroupName="LogCollector.Heat"
      DirectoryRefId="INSTALLDIR_LOG_COLLECTOR"
      Transforms="$(ProjectDir)xslt\LogCollector.Heat.xslt"
      OutputFile="$(ProjectDir)Features\LogCollector.Heat.wxs"
      GenerateGuidsNow="true" SuppressCom="true" SuppressRegistry="true" SuppressFragments="true" SuppressRootDirectory="true" ToolPath="$(WixToolPath)" />

    <!--TV Plugins features-->
    
    <HeatDirectory
      Directory="$(SolutionDir)..\Bin\MP2-Client\bin\$(Configuration)\Plugins\SlimTv.Client"
      PreprocessorVariable="var.SlimTv.Client.TargetDir"
      ComponentGroupName="SlimTv.Client.Heat"
      DirectoryRefId="CLIENT_PLUGINS_FOLDER"
      OutputFile="$(ProjectDir)Features\TV\SlimTv.Client.Heat.wxs"
      GenerateGuidsNow="true" SuppressCom="true" SuppressRegistry="true" SuppressFragments="true" SuppressRootDirectory="false" ToolPath="$(WixToolPath)" />
    
    <HeatDirectory
      Directory="$(SolutionDir)..\Bin\MP2-Client\bin\$(Configuration)\Plugins\SlimTv.NativeProvider"
      PreprocessorVariable="var.SlimTv.NativeProvider.TargetDir"
      ComponentGroupName="SlimTv.NativeProvider.Heat"
      DirectoryRefId="CLIENT_PLUGINS_FOLDER"
      OutputFile="$(ProjectDir)Features\TV\SlimTv.NativeProvider.Heat.wxs"
      GenerateGuidsNow="true" SuppressCom="true" SuppressRegistry="true" SuppressFragments="true" SuppressRootDirectory="false" ToolPath="$(WixToolPath)" />

    <HeatDirectory
      Directory="$(SolutionDir)..\Bin\MP2-Server\bin\$(Configuration)\Plugins\SlimTv.Service3"
      PreprocessorVariable="var.SlimTv.Service3.TargetDir"
      ComponentGroupName="SlimTv.Service3.Heat"
      DirectoryRefId="SERVER_PLUGINS_FOLDER"
      OutputFile="$(ProjectDir)Features\TV\SlimTv.Service3.Heat.wxs"
      GenerateGuidsNow="true" SuppressCom="true" SuppressRegistry="true" SuppressFragments="true" SuppressRootDirectory="false" ToolPath="$(WixToolPath)" />

    <HeatDirectory
      Directory="$(SolutionDir)..\Bin\MP2-Server\bin\$(Configuration)\Plugins\SlimTv.Service35"
      PreprocessorVariable="var.SlimTv.Service35.TargetDir"
      ComponentGroupName="SlimTv.Service35.Heat"
      DirectoryRefId="SERVER_PLUGINS_FOLDER"
      OutputFile="$(ProjectDir)Features\TV\SlimTv.Service35.Heat.wxs"
      GenerateGuidsNow="true" SuppressCom="true" SuppressRegistry="true" SuppressFragments="true" SuppressRootDirectory="false" ToolPath="$(WixToolPath)" />
  </Target>

  <ItemGroup>
    <Resources Include="$(ProjectDir)MP2-Setup-Logging.bat"/>
  </ItemGroup>

  <Target Name="AfterBuild">
    <Copy SourceFiles="@(Resources)" DestinationFolder="$(TargetDir)en-us\" />
  </Target>

</Project>
