<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <PluginDestination>$(SolutionDir)..\Bin\$(SolutionName)\$(OutDir)Plugins\$(ProjectName)\</PluginDestination>
  </PropertyGroup>

  <ItemGroup>
    <PluginFiles Include="$(TargetDir)$(ProjectName).dll" />
    <PluginFiles Include="$(ProjectDir)plugin.xml" />
  </ItemGroup>

  <ItemGroup Condition=" '$(Configuration)' == 'Debug'">
    <PluginFiles Include="$(TargetDir)$(ProjectName).pdb" />
  </ItemGroup>

  <ItemGroup>
    <References Include="$(TargetDir)System.Data.SQLite.dll" />
    <References Include="$(TargetDir)System.Data.SQLite.Linq.dll" />
  </ItemGroup>

  <ItemGroup>
    <SQLiteInterop64 Include="$(TargetDir)x64\SQLite.Interop.dll" />
  </ItemGroup>
  <ItemGroup>
    <SQLiteInterop86 Include="$(TargetDir)x86\SQLite.Interop.dll" />
  </ItemGroup>

  <Target Name="CopyToOutput" AfterTargets="Build">
    <!-- The following target is imported by (and defined in) the System.Data.SQLite Core NuGet package.
         It needs to be called here, because by default it is executed only after the AfterBuild event-->
    <CallTarget Targets="CopySQLiteInteropFiles" />
    <Copy SourceFiles="@(PluginFiles)" DestinationFolder="$(PluginDestination)" />
    <Copy SourceFiles="@(References)" DestinationFolder="$(PluginDestination)" />
    <Copy SourceFiles="@(SQLiteInterop64)" DestinationFolder="$(PluginDestination)x64\" />
    <Copy SourceFiles="@(SQLiteInterop86)" DestinationFolder="$(PluginDestination)x86\" />
  </Target>

</Project>